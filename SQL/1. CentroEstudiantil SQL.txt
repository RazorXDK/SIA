CREATE DATABASE IF NOT EXISTS sistema_educativo;
USE sistema_educativo;

CREATE TABLE PAIS (
    ID_PAIS INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE_PAIS VARCHAR(255) NOT NULL
);

CREATE TABLE TIPO_ESTABLECIMIENTO (
    ID_TIPO_ESTABLECIMIENTO INT PRIMARY KEY AUTO_INCREMENT,
    DESCRIPCION VARCHAR(255) NOT NULL
);

CREATE TABLE ESTABLECIMIENTO (
    ID_ESTABLECIMIENTO INT PRIMARY KEY AUTO_INCREMENT,
    ID_PAIS INT NOT NULL,
    ID_TIPO_ESTABLECIMIENTO INT NOT NULL,
    NOMBRE VARCHAR(255) NOT NULL,
    DIRECCION VARCHAR(255),
    TELEFONO VARCHAR(20),
    CORREO_ELECTRONICO VARCHAR(255),
    ESTADO VARCHAR(50),
    FOREIGN KEY (ID_PAIS) REFERENCES PAIS(ID_PAIS),
    FOREIGN KEY (ID_TIPO_ESTABLECIMIENTO) REFERENCES TIPO_ESTABLECIMIENTO(ID_TIPO_ESTABLECIMIENTO)
);

CREATE TABLE ROLE (
    ID_ROLE INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(100) NOT NULL,
    DESCRIPCION VARCHAR(255)
);

CREATE TABLE USUARIO (
    ID_USUARIO INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(100) NOT NULL,
    APELLIDO VARCHAR(100) NOT NULL,
    CORREO_USUARIO VARCHAR(255) NOT NULL UNIQUE,
    USUARIO VARCHAR(50) NOT NULL UNIQUE,
    CONTRASEÑA VARCHAR(255) NOT NULL,
    ESTADO VARCHAR(50),
    FECHA_REGISTRO DATE NOT NULL,
    ID_ROLE INT NOT NULL,
    CARNET VARCHAR(50) NULL,
    MATRICULA VARCHAR(50) NULL,
    FECHA_NACIMIENTO DATE,
    INTENTOS_FALLIDOS INT DEFAULT 0,
    FOREIGN KEY (ID_ROLE) REFERENCES ROLE(ID_ROLE)
);

CREATE TABLE REGISTRO (
    ID_REGISTRO INT PRIMARY KEY AUTO_INCREMENT,
    ID_USUARIO INT NOT NULL,
    FECHA DATE NOT NULL,
    DIRECCION_IP VARCHAR(45),
    CLIENTE_HTTP VARCHAR(255),
    ESTADO VARCHAR(50),
    FECHA_ACTUALIZACION DATE NULL,
    FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE CARRERA (
    ID_CARRERA INT PRIMARY KEY AUTO_INCREMENT,
    ID_ESTABLECIMIENTO INT NOT NULL,
    NOMBRE VARCHAR(255) NOT NULL,
    DESCRIPCION VARCHAR(255),
    ESTADO VARCHAR(50),
    FOREIGN KEY (ID_ESTABLECIMIENTO) REFERENCES ESTABLECIMIENTO(ID_ESTABLECIMIENTO)
);

CREATE TABLE CURSO (
    ID_CURSO INT PRIMARY KEY AUTO_INCREMENT,
    ID_CARRERA INT NOT NULL,
    CODIGO_CURSO VARCHAR(50) NOT NULL UNIQUE,
    NOMBRE VARCHAR(255) NOT NULL,
    DESCRIPCION VARCHAR(255),
    CREDITOS INT NOT NULL,
    FOREIGN KEY (ID_CARRERA) REFERENCES CARRERA(ID_CARRERA)
);

CREATE TABLE INSCRIPCION (
    ID_INSCRIPCION INT PRIMARY KEY AUTO_INCREMENT,
    ID_CARRERA INT NOT NULL,
    ID_USUARIO INT NOT NULL,
    ID_ESTABLECIMIENTO INT NOT NULL,
    FECHA_INSCRIPCION DATE NOT NULL,
    UNIQUE (ID_USUARIO, ID_CARRERA),
    FOREIGN KEY (ID_CARRERA) REFERENCES CARRERA(ID_CARRERA),
    FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY (ID_ESTABLECIMIENTO) REFERENCES ESTABLECIMIENTO(ID_ESTABLECIMIENTO)
);

CREATE TABLE ASIGNACION_CURSO (
    ID_ASIGNACION_CURSO INT PRIMARY KEY AUTO_INCREMENT,
    ID_CURSO INT NOT NULL,
    ID_INSCRIPCION INT NOT NULL,
    FECHA_ASIGNACION_CURSO DATE NOT NULL,
    UNIQUE (ID_INSCRIPCION, ID_CURSO),
    FOREIGN KEY (ID_CURSO) REFERENCES CURSO(ID_CURSO),
    FOREIGN KEY (ID_INSCRIPCION) REFERENCES INSCRIPCION(ID_INSCRIPCION)
);

CREATE TABLE NOTA (
    ID_NOTA INT PRIMARY KEY AUTO_INCREMENT,
    ID_ASIGNACION_CURSO INT NOT NULL,
    NOTA DECIMAL(5,2) NOT NULL,
    TIPO_NOTA VARCHAR(50) NOT NULL,
    OBSERVACIONES VARCHAR(255),
    FECHA_EVALUACION DATE NOT NULL,
    FOREIGN KEY (ID_ASIGNACION_CURSO) REFERENCES ASIGNACION_CURSO(ID_ASIGNACION_CURSO)
);

INSERT INTO PAIS (NOMBRE_PAIS) VALUES ('Argentina'), ('Brasil'), ('Chile'), ('México'), ('Colombia');

INSERT INTO ESTABLECIMIENTO (ID_PAIS, ID_TIPO_ESTABLECIMIENTO, NOMBRE, DIRECCION, TELEFONO, CORREO_ELECTRONICO, ESTADO) VALUES
(1, 1, 'Universidad Nacional', 'Av. Siempre Viva 742', '123456789', 'contacto@un.edu', 'Activo'),
(2, 2, 'Instituto Tecnológico', 'Calle Principal 123', '987654321', 'info@it.edu', 'Activo'),
(3, 1, 'Escuela de Negocios', 'Zona Financiera', '1122334455', 'admin@business.edu', 'Inactivo');


SELECT es.NOMBRE
FROM `establecimiento` aS es
WHERE es.ID_ESTABLECIMIENTO=1



SELECT es.NOMBRE, p.NOMBRE_PAIS, tes.DESCRIPCION
FROM `establecimiento` aS es
INNER JOIN pais p ON p.ID_PAIS=es.ID_PAIS
INNER JOIN tipo_establecimiento tes ON tes.ID_TIPO_ESTABLECIMIENTO = es.ID_TIPO_ESTABLECIMIENTO
WHERE es.ID_ESTABLECIMIENTO=1


SELECT e.NOMBRE, e.DIRECCION, e.TELEFONO, e.CORREO_ELECTRONICO , p.NOMBRE_PAIS
FROM sistema_educativo.establecimiento AS e
inner join sistema_educativo.pais AS p
on p.ID_PAIS =e.ID_PAIS
where e.ESTADO= 'ACTIVO'
